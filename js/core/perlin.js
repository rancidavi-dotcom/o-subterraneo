const perlin = {
    p: new Uint8Array(512),
    permutation: [151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,
        190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166,
        77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196,
        135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,162,215,171,180,72,
        232,242,210,205,204,127,42,26,52,142,61,214,113,192,21,211,148,190,97,161,252,11,191,23,235,123,150,25,138,242,150,147,108,133,115,70,102,12,39,114,
        111,81,59,28,107,119,17,141,185,103,96,216,170,142,43,10,251,200,108,158,185,177,35,154,213,122,192,153,22,104,117,116,151,31,28,49,149,2,127,154,
        129,105,153,190,190,151,160,137,91,90,15,131,13,201,95], // Garantindo 256+ valores
    
    init: function() {
        for (let i = 0; i < 256; i++) {
            this.p[i] = this.p[i + 256] = this.permutation[i];
        }
    },

    fade: function(t) { return t * t * t * (t * (t * 6 - 15) + 10); },
    lerp: function(t, a, b) { return a + t * (b - a); },
    grad: function(hash, x, y) {
        const h = hash & 15;
        return ((h < 8 ? x : y) * ((h & 1) === 0 ? 1 : -1)) + 
               ((h < 4 ? y : (h === 12 || h === 14 ? x : 0)) * ((h & 2) === 0 ? 1 : -1));
    },

    noise: function(x, y) {
        try {
            const X = Math.floor(x) & 255;
            const Y = Math.floor(y) & 255;
            x -= Math.floor(x);
            y -= Math.floor(y);
            const u = this.fade(x);
            const v = this.fade(y);
            const a = this.p[X] + Y, aa = this.p[a], ab = this.p[a + 1];
            const b = this.p[X + 1] + Y, ba = this.p[b], bb = this.p[b + 1];

            return this.lerp(v, this.lerp(u, this.grad(this.p[aa], x, y),
                                         this.grad(this.p[ba], x - 1, y)),
                                this.lerp(u, this.grad(this.p[ab], x, y - 1),
                                         this.grad(this.p[bb], x - 1, y - 1)));
        } catch (e) { return Math.random(); }
    }
};

perlin.init();
window.perlin = perlin;