<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O Subterr√¢neo - Em Jogo</title>
    <link rel="stylesheet" href="css/game.css">
    <link rel="stylesheet" href="css/intro.css">
</head>
<body>
    <div id="game-container">
        <div id="scene-transition"></div>
        
        <!-- Tela de Carregamento (removida para depura√ß√£o) -->

        <!-- Dr. Greg Dialogue System -->
        <div id="intro-overlay" style="display: none;">
            <div id="greg-container">
                <div class="greg-body">ü•º</div>
                <div class="greg-head">üë®‚Äçüî¨</div>
            </div>
            <div id="dialogue-box">
                <div id="character-name">Dr. Greg</div>
                <p id="dialogue-text"></p>
                <div id="skip-hint">Pressione [ESPA√áO] para fechar</div>
            </div>
        </div>

        <!-- Menu de Pausa -->
        <div id="pause-menu" class="modal-overlay" style="display: none;">
            <div class="modal-content pause-content">
                <h1>PAUSADO</h1>
                <nav class="pause-nav">
                    <button onclick="togglePause()">Continuar</button>
                    <button onclick="showSettings()">Configura√ß√µes</button>
                    <button onclick="manualSave()">Salvar Jogo</button>
                    <button onclick="window.location.href='index.html'" class="btn-danger">Sair para o Menu</button>
                </nav>
            </div>
        </div>

        <!-- Menu de Configura√ß√µes -->
        <div id="settings-menu" class="modal-overlay" style="display: none;">
            <div class="modal-content settings-content">
                <h2>Configura√ß√µes</h2>
                <div class="setting-item">
                    <span>Modo de Controle:</span>
                    <select id="control-mode-select" onchange="updateControlMode(this.value)">
                        <option value="mouse">Mouse (Clicar/Arrastar)</option>
                        <option value="wasd">Teclado (WASD)</option>
                    </select>
                </div>
                <div class="setting-item">
                    <span>Qualidade Gr√°fica:</span>
                    <select id="graphic-quality-select" onchange="updateGraphicQuality(this.value)">
                        <option value="ultra">Ultra (900 L√¢minas)</option>
                        <option value="medium">M√©dio (300 L√¢minas)</option>
                        <option value="low">Baixo (50 L√¢minas)</option>
                        <option value="ultralow">Ultra Low (Sem Grama)</option>
                    </select>
                </div>
                <div class="setting-item">
                    <span>Modo de Marca√ß√£o (F):</span>
                    <button id="settings-pheromone-btn" onclick="toggleMarkingModeFromSettings()" style="padding: 5px 10px; background: #555; border: 1px solid #777; color: white; cursor: pointer;">DESATIVADO</button>
                </div>
                <button onclick="hideSettings()">Voltar</button>
                <button onclick="deleteSaveData()" class="btn-danger">Excluir Mundo</button>
            </div>
        </div>

        <canvas id="gameCanvas"></canvas>

        <!-- Modal de Nomea√ß√£o -->
        <div id="naming-modal" style="display: none;">
            <div class="modal-content">
                <h2>Dar nome ao formigueiro</h2>
                <input type="text" id="colony-name-input" placeholder="Ex: Imp√©rio das Sombras" maxlength="20">
                <button onclick="confirmColonyName()">Confirmar Nome</button>
            </div>
        </div>

        <div id="colony-display-name" style="position: absolute; top: 10px; left: 10px; color: white; font-size: 1.2em; cursor: pointer; background-color: rgba(0,0,0,0.5); padding: 5px; border-radius: 5px;"></div>

        <!-- Alertas R√°pidos (Dr. Greg) -->
        <div id="quick-alert" style="display: none; position: absolute; top: 60px; right: 20px; background: rgba(0,0,0,0.8); border: 2px solid #ffa500; color: white; padding: 15px; border-radius: 10px; width: 250px; z-index: 1000; transition: opacity 0.5s; pointer-events: none;">
            <div style="font-weight: bold; color: #ffa500; margin-bottom: 5px; font-size: 0.8em;">üìª TRANSMISS√ÉO DO DR. GREG</div>
            <p id="quick-alert-text" style="margin: 0; font-size: 0.9em; line-height: 1.4;"></p>
        </div>

        <!-- Modal de Vit√≥ria (Loot) -->
        <div id="victory-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content" style="text-align: center; border: 2px solid gold;">
                <h2 style="color: gold;">VIT√ìRIA!</h2>
                <p id="victory-text" style="color: white; margin-bottom: 20px;">Voc√™ derrotou uma criatura!</p>
                <div style="display: flex; justify-content: space-around;">
                    <button class="build-btn" onclick="resolveVictory('eat')" style="background: #228b22;">ü•© Coletar Carne (+Food)</button>
                    <button class="build-btn" onclick="resolveVictory('tame')" style="background: #daa520;">üï∏Ô∏è Domesticar</button>
                </div>
            </div>
        </div>

        <!-- Modal de Estat√≠sticas (Quadro da Parede) -->
        <div id="stats-modal" style="display: none;">
            <div class="modal-content stats-content">
                <h2>Relat√≥rio da Col√¥nia</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <h3>üçÉ C√¢mara de Comida</h3>
                        <p>Estoque: <span id="stat-food-count">0</span> / <span id="stat-food-max">0</span></p>
                        <div class="bar-bg"><div id="bar-food" class="bar-fill"></div></div>
                    </div>
                    <div class="stat-box">
                        <h3>üêú C√¢mara de Ovos</h3>
                        <p>Popula√ß√£o: <span id="stat-ant-count">0</span> / <span id="stat-ant-max">0</span></p>
                        <div class="bar-bg"><div id="bar-ants" class="bar-fill"></div></div>
                    </div>
                    <div class="stat-box" id="stat-box-fungus" style="display: none;">
                        <h3>üçÑ Estoque de Fungos</h3>
                        <p>Quantidade: <span id="stat-fungus-count">0</span> / <span id="stat-fungus-max">50</span></p>
                        <div class="bar-bg"><div id="bar-fungus" class="bar-fill" style="background-color: #8b4513;"></div></div>
                    </div>
                    <div class="stat-box" id="stat-box-water" style="display: none; border-color: #00bfff;">
                        <h3>üíß Gotas D'√°gua</h3>
                        <p>Raridade: <span id="stat-water-count">0</span></p>
                    </div>
                </div>
                <button onclick="closeStats()">Fechar Relat√≥rio</button>
            </div>
        </div>

        <div id="side-ui">
            <!-- Status da Rainha -->
            <div id="queen-status-panel" class="status-p1">
                <div style="font-weight: bold; color: gold; margin-bottom: 5px;">üëë <span id="ui-queen-name">Rainha</span></div>
                <div style="font-size: 0.8em; color: white;">Vida:</div>
                <div style="width: 100%; background: #333; height: 10px; border-radius: 5px;">
                    <div id="queen-hp-bar" style="width: 100%; background: #ff4444; height: 100%; border-radius: 5px; transition: width 0.5s;"></div>
                </div>
                <div style="font-size: 0.8em; color: white; margin-top: 5px;">Fome:</div>
                <div style="width: 100%; background: #333; height: 10px; border-radius: 5px;">
                    <div id="queen-hunger-bar" style="width: 100%; background: #ffa500; height: 100%; border-radius: 5px; transition: width 0.5s;"></div>
                </div>
                <button onclick="feedQueen(queen)" style="margin-top: 8px; width: 100%; background: #8b4513; border: none; color: white; padding: 5px; cursor: pointer; border-radius: 5px;">
                    üçñ Comer (1 Folha)
                </button>
            </div>
            <button class="side-btn" onclick="toggleSidebar('ant-sidebar')">üêú Formigas</button>
            <button class="side-btn" onclick="toggleSidebar('caste-sidebar')">üß¨ Evolu√ß√£o</button>
            <button class="side-btn" onclick="toggleSidebar('work-sidebar')">üõ†Ô∏è Trabalho</button>
            <button class="side-btn" onclick="toggleConstructionHUD()">üèõÔ∏è Constru√ß√µes</button>
        </div>

        
        <!-- Sidebar de Col√¥nia -->
        <div id="ant-sidebar" class="sidebar">
            <canvas class="sidebar-ant-canvas" width="80" height="120"></canvas>
            <button class="sidebar-toggle-handle" onclick="toggleSidebar('ant-sidebar')">‚óÄ</button>
            <div class="sidebar-header">
                <h3>Col√¥nia</h3>
            </div>
            <div class="sidebar-section">
                <h4>Rainhas</h4>
                <!-- Preenchido dinamicamente por sidebar.js -->
            </div>
            <div class="sidebar-section">
                <h4>Formigas</h4>
                <div class="unit-item">üë∑ <span id="worker-count-detail">0</span> Oper√°rias</div>
                <div class="unit-item">üõ°Ô∏è <span id="soldier-count-detail">0</span> Soldadas</div>
                <div class="unit-item">üèÉ <span id="scout-count-detail">0</span> Exploradoras</div>
                
                <button class="build-btn" style="margin-top: 15px; width: 100%; background: #8b0000; border: 1px solid gold;" onclick="recallAllToQueen()">
                    üö® Chamar Todas (Escolta)
                </button>
                <button class="build-btn" style="margin-top: 5px; width: 100%; background: #228b22; border: 1px solid #90ee90;" onclick="dismissGuard()">
                    üïäÔ∏è Voltar ao Trabalho
                </button>
            </div>
        </div>

        <!-- Sidebar de Evolu√ß√£o (Castas) -->
        <div id="caste-sidebar" class="sidebar">
            <canvas class="sidebar-ant-canvas" width="80" height="120"></canvas>
            <button class="sidebar-toggle-handle" onclick="toggleSidebar('caste-sidebar')">‚óÄ</button>
            <div class="sidebar-header">
                <h3>Evolu√ß√£o</h3>
            </div>
            <div class="sidebar-section">
                <div class="work-task">
                    <span>üë∑ Oper√°ria</span>
                    <div class="task-controls">
                        <button class="build-btn" onclick="generateWorkerAnt('worker')">Gerar</button>
                    </div>
                </div>
                <p style="font-size: 0.7rem; color: #8b4513; margin-top: -5px;">Custo: 20 Fungos</p>
            </div>
            <div class="sidebar-section">
                <div class="work-task">
                    <span>üõ°Ô∏è Soldada</span>
                    <div class="task-controls">
                        <button class="build-btn" onclick="generateWorkerAnt('soldier')">Gerar</button>
                    </div>
                </div>
                <p style="font-size: 0.7rem; color: #8b4513; margin-top: -5px;">Custo: 40 Fungos</p>
            </div>
        </div>

        <!-- Sidebar de Trabalho -->
        <div id="work-sidebar" class="sidebar">
            <canvas class="sidebar-ant-canvas" width="80" height="120"></canvas>
            <button class="sidebar-toggle-handle" onclick="toggleSidebar('work-sidebar')">‚óÄ</button>
            <div class="sidebar-header">
                <h3>Trabalho</h3>
            </div>
            <div class="sidebar-section">
                <div class="work-task">
                    <span>üçÉ Coletar Comida</span>
                    <div class="task-controls">
                        <button onclick="changeTask('food', -1)">-</button>
                        <span id="task-food-count">0</span>
                        <button onclick="changeTask('food', 1)">+</button>
                    </div>
                </div>
                <p style="font-size: 0.8rem; color: #8b4513;">Dispon√≠veis: <span id="idle-workers-display">0</span></p>
            </div>
        </div>

        <!-- HUD de Constru√ß√£o -->
        <div id="construction-hud" class="modal-overlay" style="display: none;">
            <div class="modal-content construction-content">
                <h2>Constru√ß√µes</h2>
                <div id="construction-options">
                    <div class="construction-item" id="construct-eggs">
                        <button class="build-btn" onclick="buildChamber('eggs')">Fazer c√¢mara de ovos</button>
                        <span class="cost-display">Custo: Gr√°tis</span>
                    </div>
                    <div class="construction-item" id="construct-food">
                        <button class="build-btn" onclick="buildChamber('food')">C√¢mara da comida</button>
                        <span class="cost-display">Custo: Gr√°tis</span>
                    </div>
                    <div class="construction-item" id="construct-fungus">
                        <button class="build-btn" onclick="buildChamber('fungus')">C√¢mara de Fungos</button>
                        <span class="cost-display">Custo: 20 Folhas</span>
                    </div>
                    <div class="construction-item" id="construct-domestication">
                        <button class="build-btn" onclick="buildChamber('domestication')">C√¢mara de Domestica√ß√£o</button>
                        <span class="cost-display">Custo: 50 Folhas</span>
                    </div>
                    <div class="construction-item" id="construct-stockpile">
                        <button class="build-btn" onclick="buildChamber('stockpile')">√Årea de Estocar Alimentos</button>
                        <span class="cost-display">Custo: 40 Folhas + 10 Fungos</span>
                    </div>
                </div>
                <button onclick="toggleConstructionHUD()" class="btn-danger">Fechar</button>
            </div>
        </div>
        
        <div id="ui-overlay">
            <div id="zoom-controls">
                <button onclick="changeZoom(0.1)">+</button>
                <button onclick="changeZoom(-0.1)">-</button>
            </div>
            <!-- Recurso bar removido a pedido do usu√°rio -->
        </div>
        <div id="game-time-display" style="position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); color: white; font-size: 0.8em; background-color: rgba(0,0,0,0.5); padding: 5px; border-radius: 5px; text-align: center;">
            Ano: <span id="game-year">1</span> | Esta√ß√£o: <span id="game-season">Primavera</span><br>
            Dia: <span id="game-day">1</span> | Hora: <span id="game-hour">00:00</span>
        </div>

        </div>

    </div>

    <script src="js/core/perlin.js"></script>
    <script src="js/entities/ant.js"></script>
    <script src="js/entities/creature.js"></script>
    <script src="js/world/map.js"></script>
    <script src="js/ui/sidebar.js"></script>
    <script src="js/multiplayer.js"></script>
    <script src="js/core/engine.js"></script>
    <script src="js/ui/intro.js"></script>

    <!-- Multiplayer Chat UI -->
    <div id="chat-container" style="display: none; position: absolute; bottom: 50px; left: 10px; width: 300px; height: 200px; background: rgba(0,0,0,0.7); flex-direction: column; border-radius: 5px; z-index: 2000;">
        <div id="chat-messages" style="flex: 1; overflow-y: auto; padding: 5px; color: white; font-size: 0.9em;"></div>
        <input type="text" id="chat-input" placeholder="Pressione Enter para enviar..." style="width: 100%; background: #222; border: none; color: white; padding: 5px; border-bottom-left-radius: 5px; border-bottom-right-radius: 5px;">
    </div>
    <script>
        // Functions to show/hide settings menu
        function showSettings() {
            document.getElementById('settings-menu').style.display = 'flex';
            gamePaused = true;
        }

        function hideSettings() {
            document.getElementById('settings-menu').style.display = 'none';
            gamePaused = false;
        }
    </script>
</body>
</html>